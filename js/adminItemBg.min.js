/* Ekiline for WordPress Theme, Copyright 2018 Uri Lazcano. Ekiline is distributed under the terms of the GNU GPL. http://ekiline.com */
(function(a){tinymce.PluginManager.add("custom_mce_button4",function(c,b){c.addButton("custom_mce_button4",{title:c.getLang("ekiline_tinymce.addbackground"),image:c.getLang("ekiline_tinymce.themePath")+"/img/ico-bg.png",onclick:function(k){var l=tinymce.activeEditor.selection.getNode();var g="";var i="";var f=a(l).css("background-color");if(f!="transparent"&&f!="rgba(0, 0, 0, 0)"){var d=a(l).css("background-color");j(d);function j(n){var m=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete (m[0]);for(var e=1;e<=3;++e){m[e]=parseInt(m[e]).toString(16);if(m[e].length==1){m[e]="0"+m[e]}}g="#"+m.join("")}}var h=a(l).css("background-image");if(h!=""&&h!="none"){i=h.replace('url("',"").replace('")',"")}c.windowManager.open({title:c.getLang("ekiline_tinymce.choosebgcolor"),minWidth:500,minHeight:100,body:[{type:"textbox",name:"bgvalue",id:"bgselect",value:g,},{type:"colorpicker",name:"colorpicker",id:"colorInput",value:g,onchange:function(o){var n=this.value();var m=jQuery("#bgselect");jQuery(function(e){o.preventDefault();m.val(n)})}},{type:"textbox",name:"url",id:"imageVal",value:i},{type:"button",name:"image",text:c.getLang("ekiline_tinymce.image"),onclick:function(m){jQuery(function(e){var n;m.preventDefault();if(n){n.open();return}n=wp.media({title:c.getLang("ekiline_tinymce.choosebgimg"),button:{text:c.getLang("ekiline_tinymce.choose")},multiple:false});n.on("select",function(){var p=n.state().get("selection").first().toJSON();var o=jQuery("#imageVal");o.val(p.url)});n.open()});return false}},{type:"listbox",name:"bgRep",label:c.getLang("ekiline_tinymce.bgrLab"),values:[{text:c.getLang("ekiline_tinymce.bgrDef"),value:""},{text:c.getLang("ekiline_tinymce.bgrHor"),value:"repeat-x"},{text:c.getLang("ekiline_tinymce.bgrVer"),value:"repeat-y"},{text:c.getLang("ekiline_tinymce.bgrNo"),value:"no-repeat"},]},{type:"listbox",name:"bgPos",label:c.getLang("ekiline_tinymce.bgpLab"),values:[{text:c.getLang("ekiline_tinymce.bgptlp"),value:"top left"},{text:c.getLang("ekiline_tinymce.bgptcp"),value:"top center"},{text:c.getLang("ekiline_tinymce.bgptrp"),value:"top right"},{text:c.getLang("ekiline_tinymce.bgplcp"),value:"center left"},{text:c.getLang("ekiline_tinymce.bgpccp"),value:"center center"},{text:c.getLang("ekiline_tinymce.bgpcrp"),value:"center right"},{text:c.getLang("ekiline_tinymce.bgpblp"),value:"bottom left"},{text:c.getLang("ekiline_tinymce.bgpbcp"),value:"bottom center"},{text:c.getLang("ekiline_tinymce.bgpbrp"),value:"bottom right"},]},{type:"listbox",name:"bgAtt",label:c.getLang("ekiline_tinymce.bgaLab"),values:[{text:c.getLang("ekiline_tinymce.bgaDef"),value:""},{text:c.getLang("ekiline_tinymce.bgaFix"),value:"fixed"},]},{type:"checkbox",name:"bgXt",label:c.getLang("ekiline_tinymce.bgxLab"),text:c.getLang("ekiline_tinymce.bgxDesc"),checked:false},],onsubmit:function(m){if(m.data.bgvalue!==null&&m.data.bgvalue!==""&&m.data.bgvalue!=="none"){tinymce.activeEditor.dom.setStyle(l,"background-color",m.data.bgvalue)}else{tinymce.activeEditor.dom.setStyle(l,"background-color","")}if(m.data.url!==null&&m.data.url!==""&&m.data.url!=="none"){tinymce.activeEditor.dom.setStyle(l,"background-image","url("+m.data.url+")");tinymce.activeEditor.dom.setStyle(l,"background-repeat",m.data.bgRep);tinymce.activeEditor.dom.setStyle(l,"background-position",m.data.bgPos);tinymce.activeEditor.dom.setStyle(l,"background-attachment",m.data.bgAtt);if(m.data.bgXt===true){tinymce.activeEditor.dom.addClass(l,"bg-responsive-delay")}else{if(m.data.bgXt===false){tinymce.activeEditor.dom.removeClass(l,"bg-responsive-delay")}}}else{tinymce.activeEditor.dom.setStyle(l,"background-image","")}}})}})})})(jQuery);